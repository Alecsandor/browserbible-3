<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: usfx.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: usfx.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import fs from 'fs';
import util from 'util';
import sax from 'sax';
import {Bible, BibleBook, BibleChapter, BibleVerse} from './bible';

/**
 * Parses XML USFX file and returns a single Bible object.
 * @param {string} xmlPath - the absolute or relative path to usfx xml file
 */
export function parseUSFXFile(xmlPath) {
    /* Parses a USFX xml file and returns a Bible object. */
    const strict = true, parser = sax.parser(strict);

    const bible = new Bible();
    let currentBook = null;
    const verses = [];

    let setLevel1 = false;
    let setLevel2 = false;

    parser.onerror = function(e) {
        console.log(chalk.red(`onerror: ${e}`));
    };
    parser.ontext = function(text) {
        if (!setLevel1 &amp;&amp; !setLevel2) {
            if (setLevel1) {
                currentBook.longName = text;
                setLevel1 = false;
            } else if (setLevel2) {
                currentBook.name = text;
                setLevel2 = false;
            }
        } else {
            const v = verses[verses.length - 1];
            if (v &amp;&amp; !v.text) {
                v.text = text.trim();
            }
        }
    };
    parser.onopentag = function(tag) {
        const name = tag.name;
        switch (name) {
            case 'book':
                currentBook = new BibleBook(tag.attributes.id);
                bible.addBook(currentBook);
                break;
            case 'toc':
                switch (tag.attributes.level) {
                    case '1':
                        setLevel1 = true;
                        break;
                    case '2':
                        setLevel2 = true;
                        break;
                    default:
                        break;
                }
                break;
            case 'v':
                if (tag.attributes.bcv) {
                    const ref = tag.attributes.bcv.split('.');
                    const name = ref[0];
                    const cN = parseInt(ref[1], 10); // chapter number
                    const vN = parseInt(ref[2], 10); // verse number

                    let book = bible.getBookByName(name);
                    if (!book) {
                        // TODO: need short name, long name, etc.
                        book = new BibleBook(name, name, name);
                        currentBook = book;
                        bible.addBook(book);
                    }
                    let chapter = book.getChapterByNumber(cN);
                    if (!chapter) {
                        chapter = new BibleChapter(book, cN);
                        currentBook.addChapter(chapter);
                    }
                    const v = new BibleVerse(book, chapter, vN);
                    chapter.addVerse(v);
                    verses.push(v); // XXX Need to get away from this.
                }
                break;
            default:
                // do nothing...
                // console.log(chalk.red(`${name} unrecognized!`));
                break;
        };
    };
    const xmldata = fs.readFileSync(xmlPath);
    parser.write(xmldata);
    // fs.writeFile('verses.json', JSON.stringify(bible));
    return bible;
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_.html"></a></li><li><a href="Bible.html">Bible</a></li><li><a href="BibleBook.html">BibleBook</a></li><li><a href="BibleChapter.html">BibleChapter</a></li><li><a href="BibleVerse.html">BibleVerse</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parseUSFXFile">parseUSFXFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Sep 05 2016 12:59:41 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
